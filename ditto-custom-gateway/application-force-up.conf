# Complete Ditto Gateway Configuration with Force-Up
# Replaces the default application.conf

include "ditto-gateway"

ditto {
  gateway {
    # Force-Up Bootstrap Configuration
    bootstrap {
      force-up = true
      force-up = ${?DITTO_GATEWAY_BOOTSTRAP_FORCE_UP}
    }
    
    http {
      hostname = "0.0.0.0"
      port = 8080
      port = ${?HTTP_PORT}
    }
    
    authentication {
      devops {
        password = "devops"
        password = ${?DEVOPS_PASSWORD}
      }
      status {
        password = "status"
        password = ${?STATUS_PASSWORD}
      }
    }
  }
}

# Pekko configuration with force-up overrides
pekko {
  actor {
    provider = "cluster"
  }
  
  # Critical: Force single-node cluster formation
  cluster {
    # Empty seed nodes for self-join
    seed-nodes = []
    
    # Enable automatic self-join for single-node clusters
    self-join = on
    
    # Minimum members to start cluster
    min-nr-of-members = 1
    
    # Roles
    roles = ["gateway"]
    
    # Allow weakly-up members
    allow-weakly-up-members = on
    
    # Auto-down unreachable nodes quickly (development only)
    auto-down-unreachable-after = 5s
    
    # Split Brain Resolver for single-node
    downing-provider-class = "org.apache.pekko.cluster.sbr.SplitBrainResolverProvider"
    split-brain-resolver {
      active-strategy = static-quorum
      static-quorum {
        quorum-size = 1
      }
      stable-after = 3s
    }
  }
  
  # Remote configuration - bind to all interfaces
  remote.artery {
    canonical {
      hostname = "0.0.0.0"
      port = 2551
    }
    bind {
      hostname = "0.0.0.0"
      port = 2551
    }
  }
  
  # HTTP configuration
  http {
    server {
      bind-timeout = 5s
      request-timeout = 60s
    }
  }
  
  # Management configuration
  management {
    http {
      hostname = "0.0.0.0"
      port = 8558
    }
  }
  
  # Logging
  loggers = ["org.apache.pekko.event.slf4j.Slf4jLogger"]
  loglevel = "INFO"
  logging-filter = "org.apache.pekko.event.slf4j.Slf4jLoggingFilter"
}