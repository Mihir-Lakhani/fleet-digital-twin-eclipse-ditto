# FINAL STANDALONE DITTO GATEWAY CONFIGURATION
# Pure local mode - NO clustering whatsoever
# Direct MongoDB integration without service discovery

# FORCE PURE LOCAL ACTOR SYSTEM - ABSOLUTE NO CLUSTERING
pekko {
  actor.provider = "local"  # âœ… Pure local - no clustering at all
  
  # Completely disable remoting
  remote.artery.enabled = false
  
  # Disable cluster entirely
  cluster.enabled = false
  
  # Disable management cluster features completely
  management {
    cluster.bootstrap.enabled = false
    http.enabled = false
  }
  
  # Force HTTP server to start immediately without cluster dependency
  http {
    server {
      server-header = "ditto-gateway"
      request-timeout = 20s
      idle-timeout = 60s
      bind-timeout = 1s
    }
    host-connection-pool {
      max-connections = 32
      max-open-requests = 128
    }
  }
  
  # Disable all extensions that might trigger clustering
  extensions = []
  
  # Minimal logging
  loggers = ["org.apache.pekko.event.slf4j.Slf4jLogger"]
  loglevel = "INFO"
  logging-filter = "org.apache.pekko.event.slf4j.Slf4jLoggingFilter"
  log-dead-letters = 0
  log-dead-letters-during-shutdown = off
}

# Ditto Gateway-Only Configuration
ditto {
  gateway {
    # HTTP server configuration
    http {
      hostname = "0.0.0.0"
      port = 8080
      enable = true
      
      # Request/response settings
      request-timeout = 20s
      max-content-length = 10000000
    }
    
    # Authentication - use dummy auth for immediate access
    authentication {
      dummy {
        dummy = true
      }
    }
    
    # Health check configuration
    health-check {
      enabled = true
      interval = 30s
    }
    
    # Disable service discovery completely
    service-discovery {
      dummy {
        enabled = false
      }
    }
    
    # Disable clustering features
    cluster {
      enabled = false
    }
  }
  
  # Disable clustering features in policies service
  policies {
    cluster.enabled = false
  }
  
  # Disable clustering features in things service  
  things {
    cluster.enabled = false
  }
}

# Direct MongoDB connection (bypass other services)
pekko.persistence.mongodb.mongo {
  mongouri = "mongodb://${MONGO_DB_HOSTNAME}:27017/ditto"
  database = "ditto"
  
  # Connection pool settings
  pool {
    maxSize = 100
    minSize = 0
    maxWaitTime = 2000ms
    maxConnectionLifeTime = 0ms
    maxConnectionIdleTime = 0ms
    maintenanceInitialDelay = 0ms
    maintenanceFrequency = 60s
  }
}