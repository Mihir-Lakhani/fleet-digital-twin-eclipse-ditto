{% extends "base.html" %}

{% block title %}Dashboard - Digital Twin Platform{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Dashboard Header -->
    <section class="dashboard-header">
        <div class="dashboard-title">
            <h2>Digital Twin Dashboard</h2>
            <p class="dashboard-subtitle">Monitor and manage your digital twins in real-time</p>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="/create-thing" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Create New Thing
            </a>
            <button class="btn btn-secondary" id="refresh-dashboard">
                <i class="fas fa-sync-alt"></i>
                Refresh
            </button>
        </div>
    </section>

    <!-- Statistics Cards -->
    <section class="stats-grid">
        <div class="stat-card" id="total-things-card">
            <div class="stat-icon">
                <i class="fas fa-cubes"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number" id="total-things-count">-</h3>
                <p class="stat-label">Total Things</p>
            </div>
        </div>
        
        <div class="stat-card" id="active-things-card">
            <div class="stat-icon">
                <i class="fas fa-play-circle"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number" id="active-things-count">-</h3>
                <p class="stat-label">Active Things</p>
            </div>
        </div>
        
        <div class="stat-card" id="manufacturers-card">
            <div class="stat-icon">
                <i class="fas fa-industry"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number" id="manufacturers-count">-</h3>
                <p class="stat-label">Manufacturers</p>
            </div>
        </div>
        
        <div class="stat-card" id="models-card">
            <div class="stat-icon">
                <i class="fas fa-cogs"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number" id="models-count">-</h3>
                <p class="stat-label">Models</p>
            </div>
        </div>
    </section>

    <!-- Recent Activity and Charts -->
    <section class="dashboard-content">
        <div class="dashboard-grid">
            <!-- Recent Things -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <h3>Recent Things</h3>
                    <a href="/things" class="btn btn-link">View All</a>
                </div>
                <div class="panel-content">
                    <div class="recent-things-list" id="recent-things-list">
                        <div class="loading-placeholder">
                            <i class="fas fa-spinner fa-spin"></i>
                            Loading recent things...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Things by Type Chart -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <h3>Things by Type</h3>
                </div>
                <div class="panel-content">
                    <canvas id="things-by-type-chart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Activity Feed -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <h3>Activity Feed</h3>
                </div>
                <div class="panel-content">
                    <div class="activity-feed" id="activity-feed">
                        <div class="loading-placeholder">
                            <i class="fas fa-spinner fa-spin"></i>
                            Loading activity...
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <h3>System Status</h3>
                </div>
                <div class="panel-content">
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-indicator" id="mongodb-status"></div>
                            <span>MongoDB</span>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator" id="mqtt-status"></div>
                            <span>MQTT Broker</span>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator" id="ditto-status"></div>
                            <span>Eclipse Ditto</span>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator" id="api-status"></div>
                            <span>API Server</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Dashboard-specific JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize dashboard
        window.dashboardManager = new DashboardManager();
        window.dashboardManager.init();
        
        // Refresh button handler
        document.getElementById('refresh-dashboard').addEventListener('click', function() {
            window.dashboardManager.refresh();
        });
    });
</script>
{% endblock %}